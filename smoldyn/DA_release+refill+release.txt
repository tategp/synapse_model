#Smoldyn code for the geometry of the synapse
#nm and msec

### Dimensions
dim 3
boundaries 0 -1000 1000 r
boundaries 1 -1000 1000 r
boundaries 2 -1000 1000 r

### Species
species DA AMPH
difc DA 3
difc AMPH 3
color DA(all) green
color AMPH(all) orange

display_size DA(all) 0.1
display_size AMPH(all) 0.1

### Time steps
time_start 0
time_stop 500
time_step 0.1

### Graphics
graphics opengl_good
frame_thickness 0

### Surface
start_surface presynapse
  action all both reflect
  color both red 1
  polygon both edge
  panel disk 0 0 20 100 0 0 -1 20
  panel cyl 0 0 20 0 0 170 100 20 5
  panel disk 0 0 170 100 0 0 1 20
end_surface

start_surface cleft
  action all both reflect
  color both purple 1
  polygon both edge
  panel disk 0 0 0 100 0 0 -1 20
  panel cyl 0 0 0 0 0 20 100 20 2
  panel disk 0 0 20 100 0 0 1 20
end_surface

start_surface postsynapse
  action all both reflect
  color both black
  polygon both edge
  panel disk 0 0 -170 100 0 0 -1 20
  panel cyl 0 0 -170 0 0 0 100 20 5
  panel disk 0 0 0 100 0 0 1 20
end_surface

start_surface vesicle_release
  action all both reflect
  color both green 1
  polygon both edge
  panel sph 0 0 50 25 10 10
end_surface

start_surface vesicle_uptake
  action DA both absorb
  color both orange 1
  polygon both edge
  panel sph 0 0 140 25 10 10
end_surface

start_surface jump
  panel disk 0 0 869 25 0 0 1 20 #the cleft one
  panel disk 0 0 900 25 0 1 0 20 #here and below in vesicle_release #1
  panel disk 0 0 900 25 1 0 0 20 
  panel disk 0 0 900 25 0 0 1 20 
  panel disk 0 0 900 25 1 0 1 20 
  panel disk 0 0 900 25 0 1 1 20
  panel disk 0 0 900 25 1 1 0 20 
  panel disk 0 0 900 25 1 1 1 20 
  action both all j
  jump disk1 front -> disk0 front
  jump disk1 back -> disk0 front
  jump disk2 front -> disk0 front
  jump disk2 back -> disk0 front
  jump disk3 front -> disk0 front
  jump disk3 back -> disk0 front
  jump disk4 front -> disk0 front
  jump disk4 back -> disk0 front
  jump disk5 front -> disk0 front
  jump disk5 back -> disk0 front
  jump disk6 front -> disk0 front
  jump disk6 back -> disk0 front
  jump disk7 front -> disk0 front
  jump disk7 back -> disk0 front
  thickness 1
  color front lightyellow
  color back orange
end_surface

###Define compartments

start_compartment vesicle_release
  surface vesicle_release
  point 0 0 50
end_compartment

start_compartment cleft
  surface cleft
  point 0 0 0
end_compartment

start_compartment jump
  surface jump
  point 0 0 900
end_compartment
	
#Starting molecules

compartment_mol 2800 DA vesicle_release

###Commands during sim
#Note: 2800 starting mols and t=10 of jump means 2600 DA released aslong as has time to diffuse beforehand (20ms seems sufficient) 

#DA release
cmd @ 50 translatecmpt jump 1 0 0 -850
cmd @ 80 translatecmpt jump 1 0 0 850

cmd @ 110 translatecmpt jump 1 0 0 -850  
cmd @ 180 translatecmpt jump 1 0 0 850

cmd @ 220 translatecmpt jump 1 0 0 -850  
cmd @ 250 translatecmpt jump 1 0 0 850

#vesicle_release refil to 2800
cmd @ 100 fixmolcountincmpt DA 2800 vesicle_release
cmd @ 100 fixmolcountincmpt DA 100 cleft

cmd @ 200 fixmolcountincmpt DA 2800 vesicle_release
cmd @ 200 fixmolcountincmpt DA 100 cleft
 

### Outputs

output_files output molcount_vesicle.csv molcount_cleft.csv
output_format csv
cmd i 0 500 10 molcountincmpt vesicle_release molcount_vesicle.csv
cmd i 0 500 10 molcountincmpt cleft molcount_cleft.csv

end_file
